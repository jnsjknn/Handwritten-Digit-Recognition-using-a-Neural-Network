let image;
let collection = 'newdata';

function getDocument() {
  db.collection(collection).where('checked', '==', false).limit(1).get()
    .then(snapshot => {
      snapshot.forEach(val => {
        const obj = val.data();
        obj.id = val.id;
        image = obj;
      })
    }).catch(err => console.log(err));
}

function rewrite(newlabel = image.label) {
  image.label = newlabel;
  image.checked = true;
  db.collection(collection).doc(image.id).set(image)
    .then(function() {
      console.log("Document successfully written!");
    })
    .catch(function(error) {
      console.error("Error writing document: ", error);
    });
  setTimeout(() => getDocument(), 500);
}

function del() {
  db.collection(collection).doc(image.id).delete()
    .then(function() {
      console.log("Document successfully deleted!");
    })
    .catch(function(error) {
      console.error("Error deleting document: ", error);
    });
  setTimeout(() => getDocument(), 500);
}

function setup() {
  const canvas = createCanvas(300, 300);
  canvas.parent('canvasDiv');
  // image = {
  //   image: [255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 217, 31, 31, 217, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 253, 48, 0, 0, 135, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 239, 1, 0, 17, 217, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 249, 133, 26, 54, 179, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 150, 0, 0, 150, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 254, 93, 0, 0, 170, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 175, 0, 0, 93, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 130, 0, 0, 115, 194, 163, 169, 225, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 34, 0, 0, 0, 0, 0, 0, 2, 102, 244, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 25, 0, 0, 0, 0, 0, 0, 0, 0, 98, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 21, 0, 0, 59, 123, 112, 65, 0, 0, 11, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 41, 0, 0, 193, 255, 221, 54, 0, 0, 54, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 108, 0, 0, 27, 61, 2, 0, 0, 4, 181, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 230, 16, 0, 0, 0, 0, 0, 5, 159, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 191, 22, 0, 0, 7, 85, 210, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 252, 190, 185, 243, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255],
  //   label: 6
  // }
  //image.image = normalize(image.image);
  // image = {
  //   image: [255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,234,224,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,254,97,7,2,172,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,253,171,15,0,0,0,113,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,213,49,0,0,0,1,69,224,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,239,65,0,0,0,0,55,231,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,224,73,47,0,0,0,25,178,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,112,0,0,1,7,90,234,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,104,0,0,148,243,251,231,251,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,106,0,0,63,53,3,0,32,210,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,113,0,0,0,0,0,0,0,74,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,211,9,0,0,0,3,2,0,5,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,213,154,155,190,248,30,0,0,236,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,217,134,217,255,255,255,30,0,0,237,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,30,0,28,236,255,181,0,0,21,254,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,30,0,0,4,7,0,0,0,111,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,185,7,0,0,0,0,0,34,237,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,181,55,5,7,15,106,243,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255],
  //   label: 5
  // }
  // image = {
  //   image: [255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,216,160,166,230,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,236,97,2,0,0,18,219,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,227,31,0,0,0,0,0,114,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,136,0,0,1,8,0,0,136,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,206,14,15,141,16,0,0,216,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,246,246,100,0,0,100,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,199,0,0,21,217,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,244,32,0,0,119,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,150,0,0,50,250,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,243,24,0,0,177,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,166,0,0,39,219,121,140,253,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,139,0,0,0,0,0,0,172,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,228,19,0,0,0,0,0,190,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,217,89,23,16,91,189,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255],
  //   label: 2
  // }
}











function draw() {
  //scale(2,2)
  if (image) drawImage();
}

function drawImage() {
  //background(255);
  if (image.remove) getDocument();
  document.querySelector('#label').innerHTML = image.label;
  const w = Math.floor(Math.sqrt(image.image.length));
  const scale = 5;
  for (let i = 0; i < image.image.length; i++) {
    const x = scale * (i % w);
    const y = scale * Math.floor(i / w);
    noStroke();
    fill(image.image[i]);
    rect(x, y, scale, scale);
  }
  noFill();
  stroke(0);
  rect(0, 0, w*scale, w*scale);
}



// Poor password protection
function allowEditing() {
  const pass = document.querySelector('#pass').value;
  console.log(pass);
  if (pass.toLowerCase() == 'jns') {
    document.querySelector('#hide').style.display = 'block';
    document.querySelector('#pass').style.display = 'none';
    document.querySelector('#passBtn').style.display = 'none';
    getDocument();
  }
}

const promises = [
  fetch('../data/numbers/0.json').then(res => res.json()),
  fetch('../data/numbers/1.json').then(res => res.json())
]
let combined;

function loadAndCombine() {
  Promise.all(promises)
    .then(data => data.reduce((a, b) => a.concat(b)))
    .then(data => combined = data);
}
